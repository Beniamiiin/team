### Стандарты разработки

#### Введение

Документ является декларацией принципов разработки программного обеспечения, средств и соглашений используемых в отделе iOS разработки Rambler&Co. 

#### Чаты и средства коммуникации

В качестве основных средств коммуникации используется почта и [Slack](https://ramblercoteam.slack.com). Регистрация в Slack осуществляется по адресу корпоративной почты. Ник должен совпадать с именем корпоративного пользователя. Обязательно должна быть выставлена актуальная фотография.

**Пример:**

![](/resources/slack-example.jpg)

#### SCM

В качестве системы контроля версий/репозитория исходного кода используется Git. Хранение исходных кодов в репозитории является обязательным.

У каждого разработчика должно быть корректно настроено имя и рабочий email пользователя.
Например, в консоли это можно сделать так:

    git config --global user.name "Artem Poluektov"
    git config --global user.email "a.poluektov@rambler-co.ru"

Проверить или изменить конфиг: 

`git config --global --edit`

секция пользователя в нем:

```
[user]
    name = Artem Poluektov
    email = a.poluektov@rambler-co.ru
```

Используется [стандартный *.gitignore*](https://www.gitignore.io/api/xcode%2Cappcode%2Cswift%2Cobjective-c). Внешние зависимости необходимо добавлять в репозиторий, в том числе подключенные через CocoaPods.

#### Gitlab

[Корпоративный GitLab](https://gitlab.rambler.ru) используется в качестве web-based менеджера репозиториев. Авторизация по доменному имени/паролю. 

#### Документация

Для технической документации, относящейся к конкретным проектам, используется [корпоративный Confluence](https://confluence.rambler.ru). Авторизация осуществляется по доменному имени/паролю.

Для описания рабочих процессов, относящихся к iOS отделу, используется [отдельный репозиторий на GitHub](https://github.com/rambler-ios/team/). Все изменения и предложения проходят через Issues или Pull Requests.

#### Средства разработки

##### Общие правила

Основные средства и инструменты, используемые в разработке, должны быть согласованы и утверждены. Использование общих средств разработки упрощает взаимодействие и последующее использование артефактов, создаваемых в процессе. Использование согласованного программного обеспечения уменьшают коммерческие риски, связанные с лицензированием.

В случае необходимости использования несогласованного средства, об этом надо предупредить непосредственного руководителя.

##### Инструменты

- **IDE:** Xcode, AppCode
- **Управление зависимостями:** CocoaPods
- **Управление плагинами Xcode:** Alcatraz
- **Плагин для комментирования:** VVDocumenter
- **Плагин для маркеров TODO/FIXME:** XToDo

#### Continuous Integration

В качестве CI сервера используется [Jenkins](http://ci.dev.rambler.ru/jenkins/). Авторизация осуществляется по доменному имени.

#### Unit Testing

Используемые технологии:

- **Фреймворк для тестирования:** Ванильный XCTest
- **Библиотека для мокирования:** OCMock
- **Библиотеки для стабов сетевых запросов:** OHHTTPStubs, MMBarricade


Тест - это обычный метод, который начинается со слова *test*. Используется нотация *given/when/then*. Типичный тест выглядит таким образом:

```objc
- (void)testThatItDoesURLEncoding { 
    // given
    NSString *searchQuery = @"$&?@"; 
    HTTPRequest *request = [HTTPRequest requestWithURL:@"/search?q=%@", searchQuery];

    // when
    NSString *encodedURL = request.URL;

    // then 
    XCTAssertEqualObjects(encodedURL, @"/search?q=%24%26%3F%40");
}
```
 
В [The Book of VIPER](https://github.com/rambler-ios/The-Book-of-VIPER/blob/master/CodeStyle.md#Тесты) описаны дополнительные соглашения по тестированию.

#### Code Review

Инструмент проведения code review - [Upsource](http://srv-upsource.rambler.ramblermedia.com).

Описание процесса - *в разработке*.

#### Development Flow

##### Архитектура

В качестве основной архитектуры проектов используется [multitier architecture](https://en.wikipedia.org/wiki/Multitier_architecture), в общем случае состоящая из двух слоев - Presentation, содержащего конкретные user story, и Business Logic, содержащего независимую от конкретных use case'ов логику.

На Presentation слое используется [VIPER](https://github.com/rambler-ios/The-Book-of-VIPER). На слое бизнес-логики - [SOA](https://en.wikipedia.org/wiki/Service-oriented_architecture).

Принципы, применяемые при разработке: [SOLID](https://en.wikipedia.org/wiki/SOLID_(object-oriented_design)), [TDD](https://en.wikipedia.org/wiki/Test-driven_development).

##### Комментирование
Код должен быть быть самодокументированным, все неочевидные вещи должны быть описаны комментариями. Комментарии пишутся на русском языке. Формат комментариев:

- однострочные

  `// Текст комментария`

- многострочные
 
  ```
  /**
  * Текст комментария
  * Текст комментария
  */
  ```

Для комментариев или заметок не разрешается использоваться #warnings. Если необходимо пометить место, например, для будущего рефакторинга, необходимо использовать комментарии вида `// TODO: Текст комментария`.

Для операций, связанных с API, нужно указывать ссылки на исходную документацию вида `@see http://api.com`.

При использовании каких-либо workaround’ов необходимо указывать ссылку на радар/stackoverflow вида `@link http://stackoverflow.com/questions/8457847/ios-core-data-when-to-save-context`.

##### GIT
Для работы с git используется подход [gitflow](http://nvie.com/posts/a-successful-git-branching-model/).

Коммиты должны быть атомарными. Комментарии к коммитам пишутся на русском языке. Комментарий должен начинаться с глагола и должен объяснять суть изменений. Например,
*Исправлена ошибка при открытии экрана авторизации*.

В случае, если коммит связан с задачей в Jira, необходимо добавить в конце код задачи. Пример: *Исправлена ошибка при открытии экрана авторизации [LJIOS-234]*.

##### CocoaPods
Компоненты приложения, которые могут быть использованы в других проектах, необходимо оформить в виде пода и выложить в соответствующую группу в [GitLab](https://gitlab.rambler.ru/groups/cocoapods). Если компонент может представлять интерес для внешнего сообщества, в дальнейшем возможен его перевод на GitHub.

#### Внешние библиотеки, SDK, лицензии

Если существует готовая библиотека, реализующая требуемый функционал, то ей следует отдавать предпочтение. Лицензии библиотек должны давать право на использование в корпоративных проектах.

Стандартные стек используемых нами библиотек:

- Typhoon - DI контейнер.
- MagicalRecord - реализация ActiveRecord для CoreData.
- Nimbus/Models - реализация datasources для работы с UITableView/UICollectionView.
- CocoaLumberjack - библиотека для логирования
- SDWebImage - загрузка web изображений.
- RestKit - библиотека для маппинга/сетевого взаимодействия.
- OCMock - библиотека для мокирования объектов.
- EasyMapping - библиотека для маппинга.
- PureLayout - работа с autolayout в коде.

#### Programming style
В качестве style-guide используются следующие документы:

- [NYTimes Objective-C Style Guide](https://github.com/NYTimes/objective-c-style-guide)
- [The Book of VIPER / Вопросы Code Style](https://github.com/rambler-ios/The-Book-of-VIPER/blob/master/CodeStyle.md)